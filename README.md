<img width="1258" height="990" alt="image" src="https://github.com/user-attachments/assets/784606f7-044e-4a34-803e-3cf6674a43f7" />

# 双表匹配神器

一个基于 PyQt5 的桌面工具，用来对两张数据表进行快速匹配预览：

- 选择或拖拽两张表（支持 CSV、Excel）到左右面板
- 左右各显示前 10 行，便于确认字段与数据形态
- 在 A 表点击列头即可多选“键列”（支持多列复合键）
- 自动提示 B 表是否包含这些键列，并显示覆盖统计
- 在 B 表点击选择需要加入结果的列
- 底部实时生成“匹配结果预览”（A 全部列 + B 选中列，按键列做内连接）

## 目录结构

```
93-双表匹配神器/
├─ 双表匹配神器.py          # 主程序（PyQt5 界面、读取与匹配逻辑）
├─ create_test_tables.py     # 生成测试表脚本（优先生成 Excel，回退 CSV）
├─ A表.xlsx / B表.xlsx        # 示例测试数据（运行脚本自动生成）
```

## 环境准备

- Python 3.8+（建议）
- 必需：`PyQt5`
- 可选：`pandas`（用于读取 Excel）；如未安装，将仍然支持 CSV
- 可选：`openpyxl`（生成 Excel 测试表时的备选方案）

安装示例：

```
pip install PyQt5 pandas openpyxl
```

## 启动与快速上手

1. 运行主程序：

```
python 双表匹配神器.py
```

2. 加载数据：
- 左侧点击“选择A表”或拖拽文件到左面板
- 右侧点击“选择B表”或拖拽文件到右面板

3. 选择键列：
- 在 A 表列头点击可多选（例如：`id` + `order_no`）
- 状态栏会显示“完全包含 / 部分包含 / 不包含”，并统计覆盖数量

4. 选择结果列：
- 在 B 表列头点击选中希望合并到结果中的列（如 `status`, `amount`）

5. 查看结果预览：
- 下方自动展示匹配结果（前 200 行），A 全部列 + B 选中列（B 列名前带 `B:` 前缀）

## 生成测试数据

已提供脚本生成两张示例表：

```
python create_test_tables.py
```

- 优先生成 `A表.xlsx` 与 `B表.xlsx`
- 若缺少 `pandas/openpyxl`，脚本会回退生成 `A表.csv` 与 `B表.csv`

示例字段：
- A：`id`, `name`, `city`, `order_no`, `date`
- B：`id`, `order_no`, `status`, `amount`, `remark`

常见键选择：`id` + `order_no`（复合键），也可仅选 `id` 观察部分匹配与多对多情况。

## 匹配规则与说明

- 键列来自 A 表点击选中的列；要求这些列在 B 表中存在同名列
- 预览结果为“内连接”：A 行与 B 行拥有相同键时组合输出
- 若 B 表中存在重复键，预览会显示“一对多”多条匹配行
- 覆盖统计：显示 A 唯一键数量与其在 B 中的命中数量

## 常见问题

- 读取 Excel 需要 `pandas`；未安装时仍可读取 CSV
- 预览限制为前 200 行，避免大数据渲染卡顿
- CSV 编码按 `utf-8 / utf-8-sig / gb18030` 顺序尝试
- 键列必须在 B 表中存在同名列，否则状态栏会提示缺少列

## 下一步计划（可按需实现）

- 导出预览结果为 CSV/Excel
- 支持“键列映射”（例如 A:`user_id` 对应 B:`uid`）
- 过滤条件、去重策略与聚合汇总
- 大文件优化（分页、懒加载）

## 许可证

未指定，默认按个人项目使用。若需开源许可证，请告知我添加。

